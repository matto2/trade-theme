{% comment %}
  Renders a contact form for products requiring quotes

  Accepts:
  - product: {Object} Product Liquid object (required)
  - block: {Object} Block object with settings (optional)
  - form_id: {String} Unique form ID (optional)

  Usage:
  {% render 'contact-form', product: product, block: block %}
{% endcomment %}

{%- liquid
  assign form_id = form_id | default: 'ContactForm'
  assign heading = block.settings.heading | default: 'Contact Us'
  assign message = block.settings.message | default: 'Please contact us for pricing and availability.'
  assign button_text = block.settings.button_text | default: 'Send Inquiry'
-%}

<div class="product-contact-form" {{ block.shopify_attributes | default: '' }}>
  <div class="contact-form-wrapper">
    <div class="contact-form-header">
      <h3 class="contact-form-heading">{{ heading }}</h3>
      {% if message != blank %}
        <p class="contact-form-message">{{ message }}</p>
      {% endif %}
    </div>

    {% comment %} Contact Form {% endcomment %}
    {% form 'contact', id: form_id, class: 'contact-form' %}
      {% if form.posted_successfully? %}
        <div class="form-success-message">
          <p>{{ 'contact.form.post_success' | t | default: 'Thank you for contacting us. We will get back to you as soon as possible.' }}</p>
        </div>
      {% endif %}

      {% if form.errors %}
        <div class="form-error-message">
          <h4>{{ 'contact.form.error_heading' | t | default: 'Please correct the following:' }}</h4>
          {% for field in form.errors %}
            <p>{{ field | capitalize }} {{ form.errors.messages[field] }}</p>
          {% endfor %}
        </div>
      {% endif %}

      <input type="hidden" name="contact[subject]" value="Product Inquiry: {{ product.title }}">

      <div class="field-group">
        <div class="field">
          <label for="{{ form_id }}-name" class="field__label">
            {{ 'contact.form.name' | t | default: 'Name' }} <span class="required">*</span>
          </label>
          <input
            type="text"
            name="contact[name]"
            id="{{ form_id }}-name"
            class="field__input"
            value="{{ form.name }}"
            required
            aria-required="true"
          >
        </div>

        <div class="field">
          <label for="{{ form_id }}-email" class="field__label">
            {{ 'contact.form.email' | t | default: 'Email' }} <span class="required">*</span>
          </label>
          <input
            type="email"
            name="contact[email]"
            id="{{ form_id }}-email"
            class="field__input"
            value="{{ form.email }}"
            required
            aria-required="true"
            {% if form.errors contains 'email' %}
              aria-invalid="true"
              aria-describedby="{{ form_id }}-email-error"
            {% endif %}
          >
          {% if form.errors contains 'email' %}
            <div id="{{ form_id }}-email-error">
              <span class="form__message">{{ form.errors.translated_fields['email'] | capitalize }} {{ form.errors.messages['email'] }}</span>
            </div>
          {% endif %}
        </div>
      </div>

      <div class="field">
        <label for="{{ form_id }}-phone" class="field__label">
          {{ 'contact.form.phone' | t | default: 'Phone Number' }}
        </label>
        <input
          type="tel"
          name="contact[phone]"
          id="{{ form_id }}-phone"
          class="field__input"
          value="{{ form.phone }}"
        >
      </div>

      <div class="field">
        <label for="{{ form_id }}-message" class="field__label">
          {{ 'contact.form.comment' | t | default: 'Message' }}
        </label>
        <textarea
          name="contact[body]"
          id="{{ form_id }}-message"
          class="field__input field__input--textarea"
          rows="4"
        >{% if form.body == blank %}I'm interested in {{ product.title }}. Please provide pricing and availability information.{% else %}{{ form.body }}{% endif %}</textarea>
      </div>

      <div class="contact-form-actions">
        <button type="submit" class="btn product-form__cart-submit button button--full-width">
          <span>{{ button_text }}</span>
        </button>
      </div>
    {% endform %}
  </div>
</div>

<style>
  .product-contact-form {
    margin: 1.5rem 0;
    padding: 1.5rem;
    border: 2px solid #007acc;
    border-radius: 8px;
    background: #f8fcff;
  }

  .contact-form-header {
    margin-bottom: 1.5rem;
    text-align: center;
  }

  .contact-form-heading {
    margin: 0 0 0.5rem 0;
    font-size: 1.3em;
    color: #007acc;
    font-weight: 600;
  }

  .contact-form-message {
    margin: 0;
    color: #333;
    font-size: 0.95em;
  }

  .contact-form {
    max-width: 100%;
  }

  .field-group {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  @media screen and (max-width: 749px) {
    .field-group {
      grid-template-columns: 1fr;
    }
  }

  .field {
    margin-bottom: 1rem;
  }

  .field__label {
    display: block;
    margin-bottom: 0.3rem;
    font-weight: 500;
    color: #333;
  }

  .required {
    color: #e74c3c;
  }

  .field__input {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 1rem;
    transition: border-color 0.2s ease;
  }

  .field__input:focus {
    outline: none;
    border-color: #007acc;
    box-shadow: 0 0 0 2px rgba(0, 122, 204, 0.1);
  }

  .field__input--textarea {
    resize: vertical;
    min-height: 100px;
    font-family: inherit;
  }

  .contact-form-actions {
    margin-top: 1.5rem;
  }

  .form-success-message {
    padding: 1rem;
    margin-bottom: 1rem;
    background: #d4edda;
    border: 1px solid #c3e6cb;
    border-radius: 4px;
    color: #155724;
  }

  .form-error-message {
    padding: 1rem;
    margin-bottom: 1rem;
    background: #f8d7da;
    border: 1px solid #f5c6cb;
    border-radius: 4px;
    color: #721c24;
  }

  .form__message {
    display: block;
    margin-top: 0.25rem;
    font-size: 0.85em;
    color: #e74c3c;
  }
</style>